<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Submit Post | SEO India Online Free Blog</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" href="https://seoindiaonline.com/wp-content/uploads/2025/04/logo.png">
<style>
body{font-family:Arial;background:#f4f6f8;margin:0}
.container{max-width:1200px;margin:30px auto;background:#fff;padding:20px}
.editor-wrap{display:flex;gap:20px}
textarea{width:50%;height:400px;font-family:monospace}
.preview{width:50%;border:1px solid #ccc;padding:15px;background:#fafafa}
button{margin-top:15px;padding:10px 20px;background:#0a3d62;color:#fff;border:none}
</style>
</head>

<body>
<div class="container">
<h1>Submit Blog Post</h1>

<input id="title" placeholder="Post Title" style="width:100%;padding:10px;margin-bottom:10px">

<div class="editor-wrap">
  <textarea id="content" placeholder="HTML / Markdown / BBCode supported"></textarea>
  <div class="preview" id="preview">Live previewâ€¦</div>
</div>

<button id="publish">Publish</button>
</div>

<script type="module">
import { auth, db } from "./firebase.js";
import {
  addDoc, collection, serverTimestamp,
  query, where, getDocs
} from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

/* slug helpers */
const slugify=t=>t.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");
async function uniqueSlug(base){
 let s=base,i=1;
 while(true){
  const q=query(collection(db,"posts"),where("slug","==",s));
  if((await getDocs(q)).empty) return s;
  s=`${base}-${++i}`;
 }
}

/* parser */
function parse(t){
 return t
 .replace(/^## (.*)$/gim,"<h2>$1</h2>")
 .replace(/^### (.*)$/gim,"<h3>$1</h3>")
 .replace(/\*\*(.*?)\*\*/gim,"<strong>$1</strong>")
 .replace(/\*(.*?)\*/gim,"<em>$1</em>")
 .replace(/\[b\](.*?)\[\/b\]/gim,"<strong>$1</strong>")
 .replace(/\[url=(.*?)\](.*?)\[\/url\]/gim,"<a href='$1'>$2</a>")
 .replace(/^\- (.*)$/gim,"<li>$1</li>")
 .replace(/(<li>.*<\/li>)/gims,"<ul>$1</ul>")
 .replace(/\n/g,"<br>");
}

/* live preview */
content.oninput=()=>preview.innerHTML=parse(content.value);

/* publish */
publish.onclick=async()=>{
 if(content.value.length<200) return alert("Minimum 200 words required");

 const slug=await uniqueSlug(slugify(title.value));

 await addDoc(collection(db,"posts"),{
  title:title.value,
  slug,
  content:parse(content.value),
  authorName:auth.currentUser.displayName, // FROM REGISTRATION
  createdAt:serverTimestamp(),
  status:"published"
 });

 alert("Post published");
 location.href="index.html";
};
</script>
</body>
</html>
