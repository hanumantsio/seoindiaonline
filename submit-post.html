<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">

<title>Submit Post | SEO India Online Free Blog</title>
<meta name="description" content="Submit a free SEO and digital marketing article on SEO India Online Free Blog.">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Favicon -->
<link rel="icon" href="https://seoindiaonline.com/wp-content/uploads/2025/04/logo.png" type="image/png">
<link rel="apple-touch-icon" href="https://seoindiaonline.com/wp-content/uploads/2025/04/logo.png">

<style>
body{margin:0;font-family:Arial;background:#f4f6f8}
nav{background:#062f4f;padding:12px;text-align:center}
nav a{color:#fff;margin:0 12px;font-weight:bold;text-decoration:none}

.container{
  max-width:1200px;
  margin:30px auto;
  background:#fff;
  padding:20px
}
.editor-wrap{
  display:flex;
  gap:20px
}
.editor, .preview{
  width:50%;
  border:1px solid #ccc;
  padding:15px;
  min-height:400px;
  overflow:auto
}
.editor textarea{
  width:100%;
  height:100%;
  border:none;
  outline:none;
  resize:none;
  font-family:monospace;
  font-size:14px
}
.preview{
  background:#fafafa
}
button{
  margin-top:15px;
  padding:10px 20px;
  background:#0a3d62;
  color:#fff;
  border:none;
  cursor:pointer
}
</style>
</head>

<body>

<nav>
  <a href="index.html">Home</a>
  <a href="posts.html">Posts</a>
  <a href="submit-post.html">Submit</a>
</nav>

<div class="container">
  <h1>Submit Blog Post</h1>

  <input id="title" placeholder="Post Title" style="width:100%;padding:10px;margin-bottom:10px">

  <div class="editor-wrap">
    <!-- LEFT: EDITOR -->
    <div class="editor">
      <textarea id="content" placeholder="Write your post here (HTML / Markdown / BBCode supported)"></textarea>
    </div>

    <!-- RIGHT: LIVE PREVIEW -->
    <div class="preview" id="preview">
      <em>Live preview will appear hereâ€¦</em>
    </div>
  </div>

  <button id="publish">Publish Post</button>
</div>

<script type="module">
import { auth, db } from "./firebase.js";
import {
  addDoc,
  collection,
  serverTimestamp,
  query,
  where,
  getDocs
} from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

/* ---------------- SLUG ---------------- */
function generateSlug(title){
  return title.toLowerCase()
    .replace(/[^a-z0-9]+/g,"-")
    .replace(/(^-|-$)/g,"");
}

async function getUniqueSlug(base){
  let slug=base, i=1;
  while(true){
    const q=query(collection(db,"posts"),where("slug","==",slug));
    const s=await getDocs(q);
    if(s.empty) return slug;
    slug=`${base}-${++i}`;
  }
}

/* ---------------- PARSER ---------------- */
function parseContent(text){
  let html=text;

  /* Markdown */
  html=html.replace(/^## (.*$)/gim,"<h2>$1</h2>");
  html=html.replace(/^### (.*$)/gim,"<h3>$1</h3>");
  html=html.replace(/\*\*(.*?)\*\*/gim,"<strong>$1</strong>");
  html=html.replace(/\*(.*?)\*/gim,"<em>$1</em>");
  html=html.replace(/^\- (.*$)/gim,"<li>$1</li>");
  html=html.replace(/(<li>.*<\/li>)/gims,"<ul>$1</ul>");

  /* BBCode */
  html=html.replace(/\[b\](.*?)\[\/b\]/gim,"<strong>$1</strong>");
  html=html.replace(/\[i\](.*?)\[\/i\]/gim,"<em>$1</em>");
  html=html.replace(/\[url=(.*?)\](.*?)\[\/url\]/gim,"<a href='$1'>$2</a>");

  /* Line breaks */
  html=html.replace(/\n$/gim,"<br>");

  return html;
}

/* ---------------- LIVE PREVIEW ---------------- */
const textarea=document.getElementById("content");
const preview=document.getElementById("preview");

textarea.addEventListener("input",()=>{
  preview.innerHTML=parseContent(textarea.value);
});

/* ---------------- PUBLISH ---------------- */
document.getElementById("publish").onclick=async()=>{
  const title=document.getElementById("title").value.trim();
  if(!title || textarea.value.length<200){
    alert("Title required & minimum 200 words.");
    return;
  }

  const baseSlug=generateSlug(title);
  const slug=await getUniqueSlug(baseSlug);
  const contentHTML=parseContent(textarea.value);

  await addDoc(collection(db,"posts"),{
    title,
    slug,
    content:contentHTML,
    authorName:auth.currentUser.displayName,
    createdAt:serverTimestamp(),
    status:"published"
  });

  alert("Post published successfully!");
  location.href="index.html";
};
</script>

</body>
</html>
